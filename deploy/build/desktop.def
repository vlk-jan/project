Bootstrap: docker
From: continuumio/miniconda3

%help
    Custom Singularity container for <TBD>. This container
    is developed by the Department of Cybernetics, Czech Technical
    University in Prague, Czech Republic.

%setup
    [ -f "/root/.netrc" ] && cp "/root/.netrc" "${SINGULARITY_ROOTFS}/root/.netrc" || true
    mkdir -p $SINGULARITY_ROOTFS/.custom_commands
    mkdir -p $SINGULARITY_ROOTFS/.tmp

%files
    sudo /usr/bin/sudo
    ../commands/* /.custom_commands/
    ./environment.yml /.tmp/environment.yml

%post
    /opt/conda/bin/conda env create -f /.tmp/environment.yml

    chmod +x /.custom_commands/*
